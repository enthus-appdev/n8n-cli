name: License Go

on:
  push:
    branches:
      - main
      - master
  pull_request:
    types: [opened, synchronize, reopened, ready_for_review]

jobs:
  license-check:
    runs-on: ubuntu-latest
    name: License Check
    # Skip job if PR is draft or has WIP in title
    if: github.event_name != 'pull_request' || (!github.event.pull_request.draft && !contains(github.event.pull_request.title, 'WIP'))
    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - name: Cache license check
        id: license-cache
        uses: actions/cache@v5
        with:
          path: .license-check-passed
          key: license-${{ hashFiles('go.sum') }}

      - name: Run license check
        if: steps.license-cache.outputs.cache-hit != 'true'
        uses: enthus-appdev/actions/go-license-validator@main
        with:
          forbidden_licenses: ${{ vars.FORBIDDEN_LICENSES }}

      - name: Mark license check as passed
        if: steps.license-cache.outputs.cache-hit != 'true'
        run: echo "passed" > .license-check-passed
